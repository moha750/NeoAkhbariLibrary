# ุฏููู ุฅุนุฏุงุฏ ูุธุงู ุงููุตุงุฏูุฉ ูุงูุฃุฏูุงุฑ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ูุชูุงูู ูุญูุงูุฉ ููุญุฉ ุงูุชุญูู ูุน ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูุฃุฏูุงุฑ ูุงูุฏุนูุงุช.

## ๐ฏ ุงูููุฒุงุช ุงููููุฐุฉ

### 1. ุญูุงูุฉ ููุญุฉ ุงูุชุญูู (Dashboard Protection)
- โ ููุน ุงููุตูู ูุฃู ุตูุญุฉ ูู ููุญุฉ ุงูุชุญูู ุจุฏูู ุชุณุฌูู ุฏุฎูู
- โ ุงูุชุญููู ุงูุชููุงุฆู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู ุนูุฏ ูุญุงููุฉ ุงููุตูู ุบูุฑ ุงููุตุฑุญ
- โ ุงูุชุญูู ูู ุงูุฌูุณุฉ ุชููุงุฆูุงู ูู 5 ุฏูุงุฆู
- โ ูุฑุงูุจุฉ ุญุงูุฉ ุงููุตุงุฏูุฉ ูู ุงูููุช ุงููุนูู

### 2. ูุธุงู ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช (Roles & Permissions)
- โ **ุฅุฏุงุฑู (Admin)**: ูุตูู ูุงูู ูุฌููุน ุงูุชุจููุจุงุช ูุงูููุฒุงุช
- โ **ูุญุฑุฑ (Editor)**: ูุตูู ูุญุฏูุฏ ูููุญุชูู ููุท (ุงูุฃูุณุงูุ ุงููุชุจุ ุงูุฃุฌุฒุงุกุ ุงูุตูุญุงุชุ ุงููุดุฑ)
- โ ุฅุฎูุงุก ุงูุชุจููุจุงุช ุบูุฑ ุงููุตุฑุญ ุจูุง ุชููุงุฆูุงู
- โ ูุญุต ุงูุตูุงุญูุงุช ูุจู ุชูููุฐ ุฃู ุฅุฌุฑุงุก ุญุณุงุณ

### 3. ุฅุฏุงุฑุฉ ูุฑูู ุงูุนูู (Team Management)
- โ ุชุจููุจ ุฎุงุต "ูุฑูู ุงูุนูู" ููุฅุฏุงุฑููู ููุท
- โ ุฅุฑุณุงู ุฏุนูุงุช ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- โ ูุธุงู ุฏุนูุงุช ุจุฑูุงุจุท ูุฑูุฏุฉ ูุขููุฉ
- โ ุตูุงุญูุฉ ุงูุฏุนูุงุช ููุฏุฉ 7 ุฃูุงู
- โ ุญุงูุงุช ุงูุฏุนูุงุช: ููุฏ ุงูุงูุชุธุงุฑุ ููุจููุฉุ ููุชููุฉ
- โ ุฅุฏุงุฑุฉ ูุงููุฉ ููุฃุนุถุงุก: ุชูุนููุ ุชุนุทููุ ุญุฐู

## ๐ ุงููููุงุช ุงููููุดุฃุฉ

### ูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- `database.sql` - ุฌุฏุงูู ุงููุณุชุฎุฏูููุ ุงูุฃุฏูุงุฑุ ุงูุฏุนูุงุช ูุน RLS Policies

### ูููุงุช ุงููุตุงุฏูุฉ
- `login.html` - ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- `signup.html` - ุตูุญุฉ ุงูุชุณุฌูู ุจุงูุฏุนูุฉ
- `auth-guard.js` - ูุธุงู ุญูุงูุฉ ููุญุฉ ุงูุชุญูู

### ูููุงุช API
- `supabase-api.js` - ุชู ุชุญุฏูุซู ุจุฏูุงู ุงููุตุงุฏูุฉ ูุงููุณุชุฎุฏููู

### ูููุงุช ููุญุฉ ุงูุชุญูู
- `dashboard.html` - ุชู ุฅุถุงูุฉ ุชุจููุจ ูุฑูู ุงูุนูู ูุญูุงูุฉ ุงูุตูุญุฉ

### Edge Functions
- `supabase/functions/send-invitation/index.ts` - ุฏุงูุฉ ุฅุฑุณุงู ุงูุฏุนูุงุช ุนุจุฑ ุงูุจุฑูุฏ

## ๐ ุฎุทูุงุช ุงูุฅุนุฏุงุฏ

### 1. ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
-- ููุฐ ูุญุชูู ููู database.sql ูู Supabase SQL Editor
-- ููููู ุงููุตูู ุฅููู ูู:
-- Supabase Dashboard > SQL Editor > New Query
```

**ุงูุฎุทูุงุช:**
1. ุงูุชุญ [Supabase Dashboard](https://app.supabase.com)
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ุงุฐูุจ ุฅูู **SQL Editor**
4. ุงูุณุฎ ูุญุชูู `database.sql` ูุงูุตูู
5. ุงุถุบุท **Run** ูุชูููุฐ ุงูุงุณุชุนูุงูุงุช

### 2. ุชูุนูู Supabase Auth

ูู Supabase Dashboard:

1. ุงุฐูุจ ุฅูู **Authentication** > **Settings**
2. ุชุฃูุฏ ูู ุชูุนูู **Email Auth**
3. ูู **Email Templates**ุ ูู ุจุชุฎุตูุต ููุงูุจ ุงูุจุฑูุฏ (ุงุฎุชูุงุฑู)

### 3. ุฅุนุฏุงุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุงุฎุชูุงุฑู - ูุฅุฑุณุงู ุงูุฏุนูุงุช ุชููุงุฆูุงู)

ุงููุธุงู ูุนูู ุจุทุฑููุชูู:
- **ูุน ุงูุจุฑูุฏ:** ุฅุฑุณุงู ุชููุงุฆู ููุฏุนูุงุช ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- **ุจุฏูู ุงูุจุฑูุฏ:** ูุณุฎ ุฑุงุจุท ุงูุฏุนูุฉ ูุฏููุงู ูุฅุฑุณุงูู

#### ุงูุทุฑููุฉ ุงูุฃููู: Supabase Built-in Email (ููุตู ุจู ููุจุฏุงูุฉ)

```
1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู: Authentication โ Settings โ Email
3. ุงุณุชุฎุฏู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ (ูุง ูุญุชุงุฌ ุฅุนุฏุงุฏ)

โ๏ธ ูุญุฏูุฏ: 4 ุฑุณุงุฆู/ุณุงุนุฉ
โ ููุงุณุจ ููุชุฌุฑุจุฉ ูุงูุชุทููุฑ
```

#### ุงูุทุฑููุฉ ุงูุซุงููุฉ: Custom SMTP (ููุฅูุชุงุฌ)

**ูุซุงู: Gmail SMTP**
```
1. ุฃูุดุฆ App Password ูู Gmail:
   https://myaccount.google.com/security โ App passwords

2. ูู Supabase Dashboard โ Authentication โ SMTP Settings:
   - Host: smtp.gmail.com
   - Port: 587
   - Username: your-email@gmail.com
   - Password: [App Password]

โ ุญุฏ ุฃุนูู: 500 ุฑุณุงูุฉ/ููู
โ ููุซูู ููุฅูุชุงุฌ
```

**๐ ุฏููู ุชูุตููู:** ุฑุงุฌุน `EMAIL_SETUP_GUIDE.md`

### 4. ุฅูุดุงุก ุฃูู ูุณุชุฎุฏู ุฅุฏุงุฑู

ููุงู ุทุฑููุชุงู:

#### ุงูุทุฑููุฉ ุงูุฃููู: ูู Console ุงููุชุตูุญ

1. ุงูุชุญ `index.html` ูู ุงููุชุตูุญ
2. ุงูุชุญ Console (F12)
3. ููุฐ ุงูููุฏ ุงูุชุงูู:

```javascript
await api.init();
await api.createFirstAdmin(
  'admin@example.com',  // ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
  'YourStrongPassword123!',  // ูููุฉ ุงููุฑูุฑ
  'ุงุณู ุงููุฏูุฑ'  // ุงูุงุณู ุงููุงูู (ุงุฎุชูุงุฑู)
);
```

#### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ูู Supabase Dashboard

1. ุงุฐูุจ ุฅูู **Authentication** > **Users**
2. ุงุถุบุท **Add user** > **Create new user**
3. ุฃุฏุฎู ุงูุจุฑูุฏ ููููุฉ ุงููุฑูุฑ
4. ุจุนุฏ ุฅูุดุงุก ุงููุณุชุฎุฏูุ ุงุฐูุจ ุฅูู **SQL Editor** ูููุฐ:

```sql
-- ุงุญุตู ุนูู role_id ููุฅุฏุงุฑู
SELECT id FROM user_roles WHERE name = 'admin';

-- ุฃุถู ุงููุณุชุฎุฏู ุฅูู ุฌุฏูู users
INSERT INTO users (id, email, role_id, is_active)
VALUES (
  'USER_ID_FROM_AUTH',  -- ูุนุฑู ุงููุณุชุฎุฏู ูู auth.users
  'admin@example.com',
  'ADMIN_ROLE_ID',  -- ูุนุฑู ุฏูุฑ ุงูุฅุฏุงุฑู ูู ุงูุงุณุชุนูุงู ุงูุณุงุจู
  true
);
```

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุชุณุฌูู ุงูุฏุฎูู

1. ุงุฐูุจ ุฅูู `login.html`
2. ุฃุฏุฎู ุงูุจุฑูุฏ ููููุฉ ุงููุฑูุฑ
3. ุณูุชู ุชุญูููู ุชููุงุฆูุงู ุฅูู ููุญุฉ ุงูุชุญูู

### ุฏุนูุฉ ุฃุนุถุงุก ุฌุฏุฏ (ููุฅุฏุงุฑููู ููุท)

1. ุณุฌู ุฏุฎูู ูุฅุฏุงุฑู
2. ุงุฐูุจ ุฅูู ุชุจููุจ **ูุฑูู ุงูุนูู**
3. ุฃุฏุฎู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุงุฎุชุฑ ุงูุฏูุฑ
4. ุงุถุบุท **ุฅุฑุณุงู ุงูุฏุนูุฉ**
5. ุณูุชู ูุณุฎ ุฑุงุจุท ุงูุฏุนูุฉ ุชููุงุฆูุงู
6. ุฃุฑุณู ุงูุฑุงุจุท ููุดุฎุต ุงููุฏุนู

### ูุจูู ุงูุฏุนูุฉ

1. ุงูุชุญ ุฑุงุจุท ุงูุฏุนูุฉ ุงูููุฑุณู
2. ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ
3. ุงุถุบุท **ุฅูุดุงุก ุงูุญุณุงุจ**
4. ุณูุชู ุชุณุฌูู ุงูุฏุฎูู ุชููุงุฆูุงู

### ุฅุฏุงุฑุฉ ุงูุฃุนุถุงุก (ููุฅุฏุงุฑููู ููุท)

ูู ุชุจููุจ **ูุฑูู ุงูุนูู**:
- **ุชูุนูู/ุชุนุทูู**: ููุน ุฃู ุงูุณูุงุญ ุจุชุณุฌูู ุงูุฏุฎูู
- **ุญุฐู**: ุญุฐู ุงูุนุถู ููุงุฆูุงู
- **ุนุฑุถ ุงูุฏุนูุงุช**: ูุชุงุจุนุฉ ุญุงูุฉ ุงูุฏุนูุงุช ุงูููุฑุณูุฉ

## ๐ ุงูุฃูุงู

### Row Level Security (RLS)

ุชู ุชูุนูู RLS ุนูู ุฌููุน ุงูุฌุฏุงูู ุงูุญุณุงุณุฉ:
- `users` - ุงููุณุชุฎุฏููู ูููููู ุฑุคูุฉ ุจูุงูุงุชูู ููุท
- `invitations` - ุงูุฅุฏุงุฑููู ููุท ูููููู ุฅุฏุงุฑุฉ ุงูุฏุนูุงุช
- `user_roles` - ุงูุฌููุน ูููููู ุฑุคูุฉ ุงูุฃุฏูุงุฑ (ูููุฑุงุกุฉ ููุท)

### ุญูุงูุฉ ุงูุตูุญุงุช

ุฌููุน ุตูุญุงุช ููุญุฉ ุงูุชุญูู ูุญููุฉ ุจู `auth-guard.js`:
- ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู
- ูุญุต ุงูุตูุงุญูุงุช
- ุฅุฎูุงุก ุงููุญุชูู ุบูุฑ ุงููุตุฑุญ ุจู

### ุฑููุฒ ุงูุฏุนูุฉ

- ุฑููุฒ ูุฑูุฏุฉ ูุนุดูุงุฆูุฉ
- ุตูุงุญูุฉ ูุญุฏูุฏุฉ (7 ุฃูุงู)
- ุงุณุชุฎุฏุงู ูุงุญุฏ ููุท
- ูุง ูููู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงููุง ุจุนุฏ ุงููุจูู

## ๐จ ุงูุชุฎุตูุต

### ุชุบููุฑ ูุฏุฉ ุตูุงุญูุฉ ุงูุฏุนูุงุช

ูู `supabase-api.js` - ุฏุงูุฉ `createInvitation`:

```javascript
// ุชุบููุฑ ูู 7 ุฃูุงู ุฅูู ุงููุฏุฉ ุงููุทููุจุฉ
expiresAt.setDate(expiresAt.getDate() + 7);  // ุบูุฑ ุงูุฑูู 7
```

### ุฅุถุงูุฉ ุฃุฏูุงุฑ ุฌุฏูุฏุฉ

ูู `database.sql`:

```sql
INSERT INTO user_roles (name, display_name, description, permissions) VALUES
('new_role', 'ุงุณู ุงูุฏูุฑ', 'ูุตู ุงูุฏูุฑ', '{"permission1": true, "permission2": true}');
```

### ุชุฎุตูุต ุงูุตูุงุญูุงุช

ูู `auth-guard.js` - ุฏุงูุฉ `canAccessTab`:

```javascript
// ุฃุถู ููุทู ุงูุตูุงุญูุงุช ุงููุฎุตุต
if (this.userRole === 'custom_role') {
    return customAllowedTabs.includes(tabName);
}
```

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ "infinite recursion detected in policy"

**ุงูุณุจุจ:** ุณูุงุณุงุช RLS ุชุญุงูู ุงููุตูู ูููุณ ุงูุฌุฏูู ุงูุฐู ุชุญููู.

**ุงูุญู:**
1. ููุฐ ุงูููุฏ ุงููุญุฏุซ ูู `database.sql` ุงูุฐู ูุณุชุฎุฏู ุฏุงูุฉ `is_admin()` ูุน `SECURITY DEFINER`
2. ุฃู ููุฐ ูุฐุง ุงูููุฏ ูู SQL Editor:

```sql
-- ุญุฐู ุงูุณูุงุณุงุช ุงููุฏููุฉ
DROP POLICY IF EXISTS "Users can view their own data" ON users;
DROP POLICY IF EXISTS "Admins can view all users" ON users;
DROP POLICY IF EXISTS "Admins can insert users" ON users;
DROP POLICY IF EXISTS "Admins can update users" ON users;
DROP POLICY IF EXISTS "Users can update own data" ON users;
DROP POLICY IF EXISTS "Admins can delete users" ON users;

-- ุฅูุดุงุก ุฏุงูุฉ ูุณุงุนุฏุฉ
CREATE OR REPLACE FUNCTION is_admin()
RETURNS BOOLEAN AS $$
BEGIN
    RETURN EXISTS (
        SELECT 1 FROM users u
        INNER JOIN user_roles r ON u.role_id = r.id
        WHERE u.id = auth.uid() AND r.name = 'admin'
    );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- ุฅูุดุงุก ุงูุณูุงุณุงุช ุงูุฌุฏูุฏุฉ
CREATE POLICY "Users can view their own data" ON users
    FOR SELECT USING (auth.uid() = id);

CREATE POLICY "Admins can view all users" ON users
    FOR SELECT USING (is_admin());

CREATE POLICY "Admins can insert users" ON users
    FOR INSERT WITH CHECK (is_admin());

CREATE POLICY "Users can update own data" ON users
    FOR UPDATE USING (auth.uid() = id OR is_admin());

CREATE POLICY "Admins can delete users" ON users
    FOR DELETE USING (is_admin());
```

### ุงููุณุชุฎุฏู ูุง ููููู ุชุณุฌูู ุงูุฏุฎูู

1. ุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ูู `auth.users`
2. ุชุญูู ูู ูุฌูุฏ ุณุฌู ูู ุฌุฏูู `users`
3. ุชุญูู ูู ุฃู `is_active = true`
4. ุชุญูู ูู ุตุญุฉ `role_id`

### ุงูุฏุนูุฉ ูุง ุชุนูู

1. ุชุญูู ูู ุตูุงุญูุฉ ุงูุฑูุฒ ูู ุฌุฏูู `invitations`
2. ุชุญูู ูู ุฃู `status = 'pending'`
3. ุชุญูู ูู ุฃู `expires_at` ูู ููุชูู
4. ุชุญูู ูู Console ููุฃุฎุทุงุก

### ุงูุชุจููุจุงุช ูุง ุชุธูุฑ

1. ุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู
2. ุชุญูู ูู ุฏูุฑ ุงููุณุชุฎุฏู
3. ุงูุชุญ Console ูุชุญูู ูู `authGuard.getUserRole()`
4. ุชุญูู ูู ุฏุงูุฉ `canAccessTab` ูู `auth-guard.js`

## ๐ ููุงุญุธุงุช ูููุฉ

### ุงูุฅูุชุงุฌ (Production)

ูุจู ุงููุดุฑ:
1. โ ุบูุฑ ุฌููุน ูููุงุช ุงููุฑูุฑ ุงูุงูุชุฑุงุถูุฉ
2. โ ูุนูู HTTPS
3. โ ุฑุงุฌุน ุณูุงุณุงุช RLS
4. โ ูุนูู Rate Limiting ูู Supabase
5. โ ุฑุงุฌุน Email Templates
6. โ ุงุฎุชุจุฑ ุฌููุน ุงูุณููุงุฑูููุงุช

### ุงููุณุฎ ุงูุงุญุชูุงุทู

ุงุญูุธ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู:
- ูุงุนุฏุฉ ุงูุจูุงูุงุช (Supabase Dashboard > Database > Backups)
- ูููุงุช ุงููุดุฑูุน
- ุฅุนุฏุงุฏุงุช Supabase

### ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

ุนูุฏ ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ:
1. ุญุฏูุซ ุฌุฏูู `user_roles` ุจุงูุตูุงุญูุงุช ุงูุฌุฏูุฏุฉ
2. ุญุฏูุซ `auth-guard.js` ุจููุทู ุงูุตูุงุญูุงุช
3. ุญุฏูุซ `dashboard.html` ุจุงูุชุจููุจุงุช ุงูุฌุฏูุฏุฉ
4. ุงุฎุชุจุฑ ูุน ุฌููุน ุงูุฃุฏูุงุฑ

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู Console ููุฃุฎุทุงุก
2. ุฑุงุฌุน Supabase Logs
3. ุชุญูู ูู Network Tab ูู DevTools
4. ุฑุงุฌุน ูุฐุง ุงูุฏููู

## โ ูุงุฆูุฉ ุงูุชุญูู

- [ ] ุชูููุฐ `database.sql` ูู Supabase
- [ ] ุชูุนูู Email Auth ูู Supabase
- [ ] ุฅูุดุงุก ุฃูู ูุณุชุฎุฏู ุฅุฏุงุฑู
- [ ] ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู
- [ ] ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุฏุนูุฉ
- [ ] ุงุฎุชุจุงุฑ ูุจูู ุฏุนูุฉ
- [ ] ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช ูููุญุฑุฑ
- [ ] ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช ููุฅุฏุงุฑู
- [ ] ูุฑุงุฌุนุฉ ุงูุฃูุงู
- [ ] ูุดุฑ ุงูุชุทุจูู

---

**ุชู ุจูุฌุงุญ! ๐**

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู. ุฌููุน ุงูููุฒุงุช ุงููุทููุจุฉ ุชู ุชูููุฐูุง ุจูุฌุงุญ.
