# ๐ง ุฅุนุฏุงุฏ ูุธุงู ุฅุฑุณุงู ุงูุฏุนูุงุช ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ุฅุฑุณุงู ุชููุงุฆู ููุฏุนูุงุช ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจุงุณุชุฎุฏุงู **Supabase Edge Functions**.

---

## ๐ ุฎุทูุงุช ุงูุฅุนุฏุงุฏ

### ุงูุฎุทูุฉ 1: ุชุซุจูุช Supabase CLI

```bash
# Windows (PowerShell)
scoop install supabase

# ุฃู ุจุงุณุชุฎุฏุงู npm
npm install -g supabase
```

### ุงูุฎุทูุฉ 2: ุชุณุฌูู ุงูุฏุฎูู ุฅูู Supabase

```bash
supabase login
```

### ุงูุฎุทูุฉ 3: ุฑุจุท ุงููุดุฑูุน

```bash
# ูู ูุฌูุฏ ุงููุดุฑูุน
cd e:\moham\Downloads\books

# ุฑุจุท ุงููุดุฑูุน (ุงุณุชุจุฏู PROJECT_ID ุจูุนุฑู ูุดุฑูุนู)
supabase link --project-ref YOUR_PROJECT_ID
```

**ููุญุตูู ุนูู PROJECT_ID:**
1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู Settings โ General
3. ุงูุณุฎ Reference ID

### ุงูุฎุทูุฉ 4: ุฑูุน Edge Function

```bash
# ุฑูุน ุฏุงูุฉ ุฅุฑุณุงู ุงูุจุฑูุฏ
supabase functions deploy send-invitation
```

### ุงูุฎุทูุฉ 5: ุชูุนูู SMTP ูู Supabase

```
1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู: Authentication โ Email Templates
3. ุงุฐูุจ ุฅูู: Settings โ Auth โ SMTP Settings
4. ูุนูู Custom SMTP (ุงุฎุชูุงุฑู)
```

**ููุงุญุธุฉ:** Supabase ูููุฑ SMTP ูุฏูุฌุ ููู ููููู ุงุณุชุฎุฏุงู ุฎุฏูุฉ ุฎุงุฑุฌูุฉ ููุญุตูู ุนูู:
- ููุงูุจ ุจุฑูุฏ ุฃุฌูู
- ูุนุฏู ุฅุฑุณุงู ุฃุนูู
- ุชุชุจุน ุฃูุถู

---

## ๐ง ุงูุฅุนุฏุงุฏ ุงูุจุฏูู (ุจุฏูู Edge Functions)

ุฅุฐุง ูู ุชุชููู ูู ุงุณุชุฎุฏุงู Edge Functionsุ ููููู ุงุณุชุฎุฏุงู ุฎุฏูุฉ ุจุฑูุฏ ุฎุงุฑุฌูุฉ ูุจุงุดุฑุฉ:

### ุงูุฎูุงุฑ 1: Resend API (ููุตู ุจู)

1. **ุฅูุดุงุก ุญุณุงุจ:**
   - ุงุฐูุจ ุฅูู: https://resend.com
   - ุณุฌู ุญุณุงุจ ุฌุฏูุฏ (ูุฌุงูู ุญุชู 3000 ุฑุณุงูุฉ/ุดูุฑ)

2. **ุงูุญุตูู ุนูู API Key:**
   - Dashboard โ API Keys โ Create API Key
   - ุงูุณุฎ ุงูููุชุงุญ

3. **ุชุญุฏูุซ ุงูููุฏ:**

```javascript
// ูู supabase-api.js
async sendInvitationEmail(email, role, inviteLink, inviterName) {
    try {
        const response = await fetch('https://api.resend.com/emails', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer YOUR_RESEND_API_KEY',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                from: 'ูุธุงู ุงูุฏุนูุงุช <invitations@yourdomain.com>',
                to: email,
                subject: 'ุฏุนูุฉ ููุงูุถูุงู ุฅูู ูุฑูู ุงูุนูู',
                html: this.getInvitationEmailTemplate(role, inviteLink, inviterName)
            })
        });

        if (!response.ok) throw new Error('ูุดู ุฅุฑุณุงู ุงูุจุฑูุฏ');
        return await response.json();
    } catch (error) {
        console.error('ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุจุฑูุฏ:', error);
        throw error;
    }
}

// ูุงูุจ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
getInvitationEmailTemplate(role, inviteLink, inviterName) {
    const roleText = role === 'admin' ? 'ุฅุฏุงุฑู' : 'ูุญุฑุฑ';
    return `
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
        <head>
            <meta charset="UTF-8">
            <style>
                body { font-family: 'Segoe UI', Tahoma, sans-serif; }
                .container { max-width: 600px; margin: 0 auto; }
                .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                         padding: 40px; text-align: center; color: white; }
                .content { padding: 40px; background: white; }
                .button { display: inline-block; padding: 15px 40px; 
                         background: #667eea; color: white; text-decoration: none; 
                         border-radius: 8px; font-weight: bold; }
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1>๐ง ุฏุนูุฉ ููุงูุถูุงู</h1>
                </div>
                <div class="content">
                    <h2>ูุฑุญุจุงู!</h2>
                    <p>ุชู ุฏุนูุชู ูู ูุจู <strong>${inviterName}</strong> ููุงูุถูุงู ุฅูู ูุฑูู ุงูุนูู.</p>
                    <p><strong>ุงูุฏูุฑ ุงููุฎุตุต ูู:</strong> ${roleText}</p>
                    <p style="text-align: center; margin: 30px 0;">
                        <a href="${inviteLink}" class="button">ูุจูู ุงูุฏุนูุฉ ูุงูุงูุถูุงู</a>
                    </p>
                    <p style="color: #999; font-size: 14px;">
                        ุฃู ุงูุณุฎ ุงูุฑุงุจุท: <a href="${inviteLink}">${inviteLink}</a>
                    </p>
                    <p style="color: #856404; background: #fff3cd; padding: 15px; border-radius: 8px;">
                        โ๏ธ ูุฐู ุงูุฏุนูุฉ ุตุงูุญุฉ ููุฏุฉ 7 ุฃูุงู ููุท.
                    </p>
                </div>
            </div>
        </body>
        </html>
    `;
}
```

### ุงูุฎูุงุฑ 2: SendGrid API

1. **ุฅูุดุงุก ุญุณุงุจ:**
   - ุงุฐูุจ ุฅูู: https://sendgrid.com
   - ุณุฌู ุญุณุงุจ ุฌุฏูุฏ (ูุฌุงูู ุญุชู 100 ุฑุณุงูุฉ/ููู)

2. **ุงูุญุตูู ุนูู API Key:**
   - Settings โ API Keys โ Create API Key
   - ุงูุณุฎ ุงูููุชุงุญ

3. **ุชุญุฏูุซ ุงูููุฏ:**

```javascript
async sendInvitationEmail(email, role, inviteLink, inviterName) {
    try {
        const response = await fetch('https://api.sendgrid.com/v3/mail/send', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer YOUR_SENDGRID_API_KEY',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                personalizations: [{
                    to: [{ email: email }],
                    subject: 'ุฏุนูุฉ ููุงูุถูุงู ุฅูู ูุฑูู ุงูุนูู'
                }],
                from: {
                    email: 'invitations@yourdomain.com',
                    name: 'ูุธุงู ุงูุฏุนูุงุช'
                },
                content: [{
                    type: 'text/html',
                    value: this.getInvitationEmailTemplate(role, inviteLink, inviterName)
                }]
            })
        });

        if (!response.ok) throw new Error('ูุดู ุฅุฑุณุงู ุงูุจุฑูุฏ');
        return { success: true };
    } catch (error) {
        console.error('ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุจุฑูุฏ:', error);
        throw error;
    }
}
```

---

## ๐จ ูุงูุจ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

ุงููุงูุจ ุงููุณุชุฎุฏู ูุชุถูู:

- โ ุชุตููู ุญุฏูุซ ูุฌุฐุงุจ
- โ ูุชูุงูู ูุน ุฌููุน ุนููุงุก ุงูุจุฑูุฏ
- โ ุฏุนู RTL (ูู ุงููููู ูููุณุงุฑ)
- โ ุฒุฑ ูุงุถุญ ูููุจูู
- โ ุฑุงุจุท ุงุญุชูุงุทู
- โ ุชุญุฐูุฑ ุจุตูุงุญูุฉ ุงูุฏุนูุฉ

### ูุนุงููุฉ ุงููุงูุจ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ง ุฏุนูุฉ ููุงูุถูุงู                   โ
โ  (ุฎูููุฉ ูุชุฏุฑุฌุฉ ุฌูููุฉ)               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                     โ
โ  ูุฑุญุจุงู!                            โ
โ                                     โ
โ  ุชู ุฏุนูุชู ูู ูุจู ุฃุญูุฏ ูุญูุฏ         โ
โ  ููุงูุถูุงู ุฅูู ูุฑูู ุงูุนูู           โ
โ                                     โ
โ  ุงูุฏูุฑ ุงููุฎุตุต ูู: ุฅุฏุงุฑู            โ
โ                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ       โ
โ  โ  ูุจูู ุงูุฏุนูุฉ ูุงูุงูุถูุงู  โ       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ       โ
โ                                     โ
โ  ุฃู ุงูุณุฎ ุงูุฑุงุจุท: https://...       โ
โ                                     โ
โ  โ๏ธ ุตุงูุญุฉ ููุฏุฉ 7 ุฃูุงู ููุท         โ
โ                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุฅุฑุณุงู ุฏุนูุฉ

```
1. ุณุฌู ุฏุฎูู ูุฅุฏุงุฑู
2. ุงุฐูุจ ุฅูู ุชุจููุจ "ูุฑูู ุงูุนูู"
3. ุฃุฏุฎู ุจุฑูุฏ ุฅููุชุฑููู ุตุญูุญ
4. ุงุฎุชุฑ ุฏูุฑ
5. ุงุถุบุท "ุฅุฑุณุงู ุงูุฏุนูุฉ"
6. โ ูุฌุจ ุธููุฑ ุฑุณุงูุฉ ูุฌุงุญ
7. โ ุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
```

### ุงุฎุชุจุงุฑ 2: ูุชุญ ุงูุฏุนูุฉ

```
1. ุงูุชุญ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
2. ุงุถุบุท ุนูู ุฒุฑ "ูุจูู ุงูุฏุนูุฉ"
3. โ ูุฌุจ ูุชุญ ุตูุญุฉ signup.html
4. โ ูุฌุจ ุนุฑุถ ูุนูููุงุช ุงูุฏุนูุฉ
5. ุฃุฏุฎู ุงูุงุณู ููููุฉ ุงููุฑูุฑ
6. โ ูุฌุจ ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ
```

### ุงุฎุชุจุงุฑ 3: ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก

```
1. ุฃููู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช
2. ุญุงูู ุฅุฑุณุงู ุฏุนูุฉ
3. โ ูุฌุจ ุนุฑุถ ุชุญุฐูุฑ
4. โ ูุฌุจ ุฅูุดุงุก ุงูุฏุนูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
5. โ ูููู ูุณุฎ ุงูุฑุงุจุท ูุฏููุงู
```

---

## ๐ ุณูุฑ ุงูุนูู

```
1. ุงูุฅุฏุงุฑู ูุฏุฎู ุจุฑูุฏ ุงูุนุถู ุงูุฌุฏูุฏ
   โ
2. ุงุฎุชูุงุฑ ุงูุฏูุฑ (ุฅุฏุงุฑู / ูุญุฑุฑ)
   โ
3. ุฅูุดุงุก ุฏุนูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   โ
4. ุชูููุฏ token ูุฑูุฏ
   โ
5. ุฅูุดุงุก ุฑุงุจุท ุงูุฏุนูุฉ
   โ
6. ุงุณุชุฏุนุงุก Edge Function
   โ
7. ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู ุฌููู
   โ
8. โ ุงููุณุชุฎุฏู ูุณุชูู ุงูุจุฑูุฏ
   โ
9. ูุชุญ ุงูุฑุงุจุท
   โ
10. ุฅูุดุงุก ุงูุญุณุงุจ
   โ
11. โ ุงูุงูุถูุงู ูููุฑูู
```

---

## ๐ ุงูุฃูุงู

### ุญูุงูุฉ Edge Function:

```typescript
// ุงูุชุญูู ูู Authorization header
const authHeader = req.headers.get('Authorization')
if (!authHeader) {
    throw new Error('Missing authorization header')
}

// ุงูุชุญูู ูู ุงููุณุชุฎุฏู
const { data: { user }, error } = await supabaseClient.auth.getUser()
if (error || !user) {
    throw new Error('Unauthorized')
}
```

### ุญูุงูุฉ ูู Spam:

```javascript
// ูููู ุฅุถุงูุฉ rate limiting
// ูุซุงู: ุญุฏ ุฃูุตู 10 ุฏุนูุงุช ูู ุงูุณุงุนุฉ
const invitationsLastHour = await this.getInvitationsCount(user.id, 1);
if (invitationsLastHour >= 10) {
    throw new Error('ุชุฌุงูุฒุช ุงูุญุฏ ุงูุฃูุตู ููุฏุนูุงุช');
}
```

---

## ๐ฏ ุงููููุฒุงุช

### โ ูุง ุชู ุชุทุจููู:

- โ ุฅุฑุณุงู ุชููุงุฆู ููุจุฑูุฏ ุงูุฅููุชุฑููู
- โ ูุงูุจ ุจุฑูุฏ ุฌููู ููุชูุงูู
- โ ุฏุนู RTL (ุงูุนุฑุจูุฉ)
- โ ูุนูููุงุช ูุงุถุญุฉ ุนู ุงูุฏุนูุฉ
- โ ุฒุฑ ูุงุถุญ ูููุจูู
- โ ุฑุงุจุท ุงุญุชูุงุทู
- โ ุชุญุฐูุฑ ุจุตูุงุญูุฉ ุงูุฏุนูุฉ
- โ ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก
- โ ูุณุฎ ุงูุฑุงุจุท ูุจุฏูู

### ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ:

- ุฅุถุงูุฉ ุชุชุจุน ูุชุญ ุงูุจุฑูุฏ
- ุฅุถุงูุฉ ุชุฐููุฑ ูุจู ุงูุชูุงุก ุงูุฏุนูุฉ
- ุฅุถุงูุฉ ุฅุญุตุงุฆูุงุช ุงูุฏุนูุงุช
- ุฅุถุงูุฉ ููุงูุจ ูุชุนุฏุฏุฉ
- ุฅุถุงูุฉ ูุบุงุช ูุชุนุฏุฏุฉ

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุญุฏูุฏ ุงูุฅุฑุณุงู

**Supabase SMTP ุงููุฏูุฌ:**
- ูุญุฏูุฏ ุจุนุฏุฏ ูุนูู ูู ุงูุฑุณุงุฆู
- ูุฏ ูููู ุจุทูุก ุฃุญูุงูุงู

**ุงูุญููู ุงูุจุฏููุฉ:**
- Resend: 3000 ุฑุณุงูุฉ/ุดูุฑ ูุฌุงูุงู
- SendGrid: 100 ุฑุณุงูุฉ/ููู ูุฌุงูุงู

### 2. Domain Verification

ูุฅุฑุณุงู ูู ูุทุงูู ุงูุฎุงุต:
```
1. ุฃุถู DNS records ูู ูุฒูุฏ ุงููุทุงู
2. ุชุญูู ูู ุงููุทุงู ูู ุฎุฏูุฉ ุงูุจุฑูุฏ
3. ุงุณุชุฎุฏู: invitations@yourdomain.com
```

### 3. Spam Folder

ูุชุฌูุจ ูุฌูุฏ Spam:
```
โ ุงุณุชุฎุฏู ูุทุงู ููุซูู
โ ูุนูู SPF, DKIM, DMARC
โ ูุง ุชุฑุณู ูููุงุช ูุจูุฑุฉ ุฏูุนุฉ ูุงุญุฏุฉ
โ ุงุณุชุฎุฏู ูุญุชูู ูุตู ูุงุถุญ
```

### 4. ุงูุชูููุฉ

```
Supabase Edge Functions: ูุฌุงูู ุญุชู 500,000 ุงุณุชุฏุนุงุก/ุดูุฑ
Resend: ูุฌุงูู ุญุชู 3000 ุฑุณุงูุฉ/ุดูุฑ
SendGrid: ูุฌุงูู ุญุชู 100 ุฑุณุงูุฉ/ููู
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ูุตู ุงูุจุฑูุฏ

**ุงูุญููู:**
```
1. ุชุญูู ูู ูุฌูุฏ Spam
2. ุชุญูู ูู ุตุญุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
3. ุชุญูู ูู logs ูู Supabase Dashboard
4. ุชุญูู ูู ุชูุนูู SMTP
5. ุฌุฑุจ ุจุฑูุฏ ุขุฎุฑ
```

### ุงููุดููุฉ: Edge Function ูุง ุชุนูู

**ุงูุญููู:**
```
1. ุชุญูู ูู ุฑูุน ุงูุฏุงูุฉ: supabase functions list
2. ุชุญูู ูู logs: supabase functions logs send-invitation
3. ุชุญูู ูู ุงูู environment variables
4. ุฃุนุฏ ุฑูุน ุงูุฏุงูุฉ: supabase functions deploy send-invitation
```

### ุงููุดููุฉ: ุฎุทุฃ ูู Authorization

**ุงูุญููู:**
```
1. ุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู
2. ุชุญูู ูู ุตูุงุญูุฉ ุงูุฌูุณุฉ
3. ุณุฌู ุฎุฑูุฌ ุซู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู
4. ุชุญูู ูู ุงูู Authorization header
```

---

## ๐ ุงููุฑุงุฌุน

- [Supabase Edge Functions](https://supabase.com/docs/guides/functions)
- [Supabase Auth Email](https://supabase.com/docs/guides/auth/auth-email)
- [Resend Documentation](https://resend.com/docs)
- [SendGrid API](https://docs.sendgrid.com/api-reference)

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู ุงุญุชุฑุงูู ูููุฑ:

- ๐ง ุฅุฑุณุงู ุชููุงุฆู ููุฏุนูุงุช
- ๐จ ูุงูุจ ุจุฑูุฏ ุฌููู
- ๐ ุฃูุงู ุนุงูู
- โก ุฃุฏุงุก ุณุฑูุน
- ๐ ุฏุนู ุงูุนุฑุจูุฉ
- ๐ ูุนุงูุฌุฉ ุฃุฎุทุงุก ูููุฉ

**ุงูุขู ูููู ููุฅุฏุงุฑููู ุฅุฑุณุงู ุฏุนูุงุช ุงุญุชุฑุงููุฉ ุจุถุบุทุฉ ุฒุฑ! ๐**
